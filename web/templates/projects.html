<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task Flow - Project Layout</title>
  <!-- Подключение стилей -->
  <link rel="stylesheet" href="/static/css/projects.css">
</head>
<body>
<div class="layout">
  <!-- Header -->
  <header class="header">
    <div class="logo">
      <img src="/static/images/flow.svg" alt="Task Flow Logo">
      <div class="title">Task Flow</div>
    </div>
    <div class="auth-buttons">
      <!-- Кнопка профиля, которая меняет действие в зависимости от наличия токена -->
      <button id="profile-button" onclick="redirectToProfile()">Profile</button>
    </div>
  </header>

  <!-- Breadcrumb -->
  <div class="breadcrumb">
    <ul>
      <li><a href="/" class="home-link">Home</a></li>
      <li class="current-page">Projects</li>
    </ul>
  </div>

  <!-- Content -->
  <main class="content-wrapper">
    <!-- Sidebar for Projects -->
    <div class="sider">
      <h2>Projects:</h2>
      <ul id="projects-list">
        <li>Loading projects...</li>
      </ul>
    </div>

    <div class="content">
      Content Area
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    © <span id="year"></span> Created by Task Flow Team
  </footer>
</div>

<!-- Подключение JavaScript -->
<script>
  // Display current year in the footer
  document.getElementById('year').textContent = new Date().getFullYear();

  async function fetchProjects() {
    const token = localStorage.getItem('token');

    if (!token) {
      alert("No token found. Please log in.");
      return;
    }

    try {
      console.log('Fetching projects...');  // Для отладки
      const response = await fetch('/api/projects', {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        }
      });

      if (!response.ok) {
        throw new Error('Error fetching projects');
      }

      const projects = await response.json();
      displayProjects(projects);
    } catch (error) {
      console.error('Error:', error);  // Для отладки
      alert(error.message);
    }
  }

  // Display project names in the sidebar
  function displayProjects(projects) {
    const projectsList = document.getElementById('projects-list');
    projectsList.innerHTML = '';

    if (projects.length === 0) {
      projectsList.innerHTML = '<li>No projects found</li>';
      return;
    }

    projects.forEach(project => {
      const projectItem = document.createElement('li');
      projectItem.classList.add('project-item');
      projectItem.textContent = project.name;
      projectItem.addEventListener('click', () => {
        window.location.href = `/projects/${project.project_id}`;
      });
      projectsList.appendChild(projectItem);
    });
  }

  // Load projects on page load
  window.onload = fetchProjects;

  // Функция для редиректа на страницу профиля или на страницу входа
  function redirectToProfile() {
    const token = localStorage.getItem('token');
    if (token) {
      // Если есть токен, перенаправить на страницу профиля
      window.location.href = '/profile';  // Замените на актуальный путь к профилю
    } else {
      // Если нет токена, перенаправить на страницу входа
      window.location.href = '/auth/sign-in';
    }
  }
</script>
</body>
</html>